<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Getting-Started</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Getting-Started</h1>



<p>This package implements methods to analyse a sequence of target
trials.</p>
<p>The steps to do this are:</p>
<ol style="list-style-type: decimal">
<li>create a data set with all the required variables</li>
<li>fit models for censoring and calculate inverse probability
weights</li>
<li>expand the data set, with records for each eligible patient for each
trial period</li>
<li>fit models for outcomes</li>
</ol>
<p>The package provides two options for conducting the analysis: an <a href="#initiators">all-in-one function</a> and a set of more <a href="#flexible">flexible functions</a>.</p>
<div id="required-data" class="section level2">
<h2>Required Data</h2>
<p>To get started a longitudinal dataset must be created containing:</p>
<ul>
<li>time period</li>
<li>patient identifier</li>
<li>treatment indicator</li>
<li>outcome indicator</li>
<li>censoring indicator</li>
<li>eligibility indicator for a trial starting in each time period</li>
<li>other covariates relating to treatment, outcome, or informative
censoring to be used in the models for weights or the outcome</li>
</ul>
<p>An example data set is included to demonstrate the format:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(TrialEmulation)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># Prepare the example data</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;trial_example&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Set columns to factors as necessary</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>trial_example<span class="sc">$</span>catvarA <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trial_example<span class="sc">$</span>catvarA)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>trial_example<span class="sc">$</span>catvarB <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(trial_example<span class="sc">$</span>catvarB)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">head</span>(trial_example)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt;    id eligible period outcome treatment catvarA catvarB catvarC nvarA nvarB</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt; 1 202        1    310       0         0       0       2       0     0    35</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt; 2 202        1    311       0         1       0       2       1     0    42</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt; 3 202        1    312       0         1       0       2       1     0    48</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt; 4 202        1    313       0         1       0       2       1     0    43</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt; 5 202        0    314       0         1       0       2       1     0    45</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt; 6 202        0    315       0         1       0       2       1     0    48</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co">#&gt;   nvarC</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co">#&gt; 1    74</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co">#&gt; 2    74</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co">#&gt; 3    74</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">#&gt; 4    75</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co">#&gt; 5    75</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">#&gt; 6    75</span></span></code></pre></div>
</div>
<div id="initiators" class="section level2">
<h2>All-in-one analysis</h2>
<p>There is an all-in-one function <code>initators()</code> which does
all of the steps with one function call. This is similar to the <a href="https://causalab.sph.harvard.edu/software/">INITIATORS SAS
macro</a>.</p>
<p>Call the <code>initiators()</code> function to run the complete
analysis:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">initiators</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">data =</span> trial_example,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">period =</span> <span class="st">&quot;period&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">eligible =</span> <span class="st">&quot;eligible&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="at">estimand_type =</span> <span class="st">&quot;ITT&quot;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;outcome&quot;</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="at">model_var =</span> <span class="st">&quot;assigned_treatment&quot;</span>,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="at">outcome_cov =</span> <span class="fu">c</span>(<span class="st">&quot;catvarA&quot;</span>, <span class="st">&quot;catvarB&quot;</span>, <span class="st">&quot;nvarA&quot;</span>, <span class="st">&quot;nvarB&quot;</span>, <span class="st">&quot;nvarC&quot;</span>),</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  <span class="at">use_censor_weights =</span> <span class="cn">FALSE</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; Starting data manipulation</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; Starting data extension</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; Summary of extended data:</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; Number of observations: 1939053</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; Preparing for model fitting</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt; Fitting outcome model</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt; glm(formula = outcome ~ assigned_treatment + trial_period + I(trial_period^2) + </span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt;     followup_time + I(followup_time^2) + catvarA + catvarB + </span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt;     nvarA + nvarB + nvarC, family = binomial(link = &quot;logit&quot;), </span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt;     data = data, weights = w)</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt;                     Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt; (Intercept)        -3.21e+00   1.41e-01  -22.76  &lt; 2e-16 ***</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt; assigned_treatment -2.73e-01   4.66e-02   -5.86  4.6e-09 ***</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt; trial_period        1.73e-03   6.01e-04    2.87  0.00404 ** </span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt; I(trial_period^2)   1.27e-06   1.48e-06    0.86  0.39199    </span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co">#&gt; followup_time       2.85e-03   5.21e-04    5.48  4.2e-08 ***</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt; I(followup_time^2) -6.90e-06   2.27e-06   -3.04  0.00233 ** </span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="co">#&gt; catvarA1            2.98e-01   2.80e-02   10.63  &lt; 2e-16 ***</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt; catvarA2            1.52e-01   3.86e-02    3.95  7.9e-05 ***</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt; catvarA3           -1.11e+01   3.48e+01   -0.32  0.75104    </span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt; catvarA7            4.13e-01   3.75e-02   11.01  &lt; 2e-16 ***</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt; catvarB1           -4.05e-01   1.12e-01   -3.63  0.00029 ***</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt; catvarB2           -4.31e-01   1.15e-01   -3.74  0.00019 ***</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt; catvarB3           -2.44e+00   3.35e-01   -7.28  3.4e-13 ***</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt; catvarB7           -7.16e-01   1.12e-01   -6.37  1.8e-10 ***</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt; nvarA              -8.55e-02   7.67e-03  -11.15  &lt; 2e-16 ***</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt; nvarB               5.35e-03   3.16e-04   16.91  &lt; 2e-16 ***</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co">#&gt; nvarC              -4.20e-02   8.76e-04  -47.97  &lt; 2e-16 ***</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 111015  on 1939052  degrees of freedom</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 107649  on 1939036  degrees of freedom</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a><span class="co">#&gt; AIC: 107683</span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 15</span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a><span class="co">#&gt; Calculating robust variance</span></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a><span class="co">#&gt; Summary with robust standard error:</span></span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a><span class="co">#&gt;                 names  estimate robust_se      2.5%     97.5%       z  p_value</span></span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a><span class="co">#&gt; 1         (Intercept) -3.21e+00  7.03e-01 -4.59e+00 -1.84e+00  -4.575 4.76e-06</span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a><span class="co">#&gt; 2  assigned_treatment -2.73e-01  3.10e-01 -8.80e-01  3.35e-01  -0.880 3.79e-01</span></span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a><span class="co">#&gt; 3        trial_period  1.73e-03  4.07e-03 -6.25e-03  9.70e-03   0.424 6.71e-01</span></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a><span class="co">#&gt; 4   I(trial_period^2)  1.27e-06  9.52e-06 -1.74e-05  1.99e-05   0.133 8.94e-01</span></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a><span class="co">#&gt; 5       followup_time  2.85e-03  3.40e-03 -3.81e-03  9.52e-03   0.840 4.01e-01</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a><span class="co">#&gt; 6  I(followup_time^2) -6.90e-06  1.62e-05 -3.87e-05  2.49e-05  -0.426 6.70e-01</span></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a><span class="co">#&gt; 7            catvarA1  2.98e-01  1.88e-01 -6.99e-02  6.66e-01   1.587 1.12e-01</span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a><span class="co">#&gt; 8            catvarA2  1.52e-01  2.84e-01 -4.03e-01  7.08e-01   0.537 5.91e-01</span></span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a><span class="co">#&gt; 9            catvarA3 -1.11e+01  9.45e-01 -1.29e+01 -9.20e+00 -11.697 0.00e+00</span></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a><span class="co">#&gt; 10           catvarA7  4.13e-01  2.17e-01 -1.32e-02  8.39e-01   1.899 5.75e-02</span></span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a><span class="co">#&gt; 11           catvarB1 -4.05e-01  3.06e-01 -1.00e+00  1.94e-01  -1.325 1.85e-01</span></span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a><span class="co">#&gt; 12           catvarB2 -4.31e-01  3.64e-01 -1.14e+00  2.82e-01  -1.186 2.36e-01</span></span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a><span class="co">#&gt; 13           catvarB3 -2.44e+00  9.25e-01 -4.25e+00 -6.27e-01  -2.637 8.36e-03</span></span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a><span class="co">#&gt; 14           catvarB7 -7.16e-01  3.04e-01 -1.31e+00 -1.20e-01  -2.354 1.86e-02</span></span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a><span class="co">#&gt; 15              nvarA -8.55e-02  4.49e-02 -1.74e-01  2.55e-03  -1.903 5.70e-02</span></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a><span class="co">#&gt; 16              nvarB  5.35e-03  2.22e-03  1.00e-03  9.70e-03   2.412 1.59e-02</span></span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a><span class="co">#&gt; 17              nvarC -4.20e-02  6.89e-03 -5.55e-02 -2.85e-02  -6.102 1.05e-09</span></span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">summary</span>(result)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; Trial Emulation Outcome Model</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; Outcome model formula:</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; outcome ~ assigned_treatment + trial_period + I(trial_period^2) + </span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt;     followup_time + I(followup_time^2) + catvarA + catvarB + </span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt;     nvarA + nvarB + nvarC</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; Coefficent summary (robust):</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt;               names  estimate robust_se      2.5%     97.5%       z p_value</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt;         (Intercept) -3.21e+00  7.03e-01 -4.59e+00 -1.84e+00  -4.575   5e-06</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt;  assigned_treatment -2.73e-01  3.10e-01 -8.80e-01  3.35e-01  -0.880   0.379</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt;        trial_period  1.73e-03  4.07e-03 -6.25e-03  9.70e-03   0.424   0.671</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt;   I(trial_period^2)  1.27e-06  9.52e-06 -1.74e-05  1.99e-05   0.133   0.894</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt;       followup_time  2.85e-03  3.40e-03 -3.81e-03  9.52e-03   0.840   0.401</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt;  I(followup_time^2) -6.90e-06  1.62e-05 -3.87e-05  2.49e-05  -0.426   0.670</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt;            catvarA1  2.98e-01  1.88e-01 -6.99e-02  6.66e-01   1.587   0.112</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt;            catvarA2  1.52e-01  2.84e-01 -4.03e-01  7.08e-01   0.537   0.591</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt;            catvarA3 -1.11e+01  9.45e-01 -1.29e+01 -9.20e+00 -11.697  &lt;2e-16</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt;            catvarA7  4.13e-01  2.17e-01 -1.32e-02  8.39e-01   1.899   0.058</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt;            catvarB1 -4.05e-01  3.06e-01 -1.00e+00  1.94e-01  -1.325   0.185</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt;            catvarB2 -4.31e-01  3.64e-01 -1.14e+00  2.82e-01  -1.186   0.236</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt;            catvarB3 -2.44e+00  9.25e-01 -4.25e+00 -6.27e-01  -2.637   0.008</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt;            catvarB7 -7.16e-01  3.04e-01 -1.31e+00 -1.20e-01  -2.354   0.019</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt;               nvarA -8.55e-02  4.49e-02 -1.74e-01  2.55e-03  -1.903   0.057</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt;               nvarB  5.35e-03  2.22e-03  1.00e-03  9.70e-03   2.412   0.016</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt;               nvarC -4.20e-02  6.89e-03 -5.55e-02 -2.85e-02  -6.102   1e-09</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt; result$model contains the fitted glm model object.</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt; result$robust$matrix contains the full robust covariance matrix.</span></span></code></pre></div>
<p>By default, this returns the final <code>glm</code> model object and
the results using the sandwich estimator.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">summary</span>(result<span class="sc">$</span>model)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; glm(formula = outcome ~ assigned_treatment + trial_period + I(trial_period^2) + </span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt;     followup_time + I(followup_time^2) + catvarA + catvarB + </span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt;     nvarA + nvarB + nvarC, family = binomial(link = &quot;logit&quot;), </span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;     data = data, weights = w)</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;                     Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; (Intercept)        -3.21e+00   1.41e-01  -22.76  &lt; 2e-16 ***</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; assigned_treatment -2.73e-01   4.66e-02   -5.86  4.6e-09 ***</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; trial_period        1.73e-03   6.01e-04    2.87  0.00404 ** </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; I(trial_period^2)   1.27e-06   1.48e-06    0.86  0.39199    </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; followup_time       2.85e-03   5.21e-04    5.48  4.2e-08 ***</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; I(followup_time^2) -6.90e-06   2.27e-06   -3.04  0.00233 ** </span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; catvarA1            2.98e-01   2.80e-02   10.63  &lt; 2e-16 ***</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; catvarA2            1.52e-01   3.86e-02    3.95  7.9e-05 ***</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; catvarA3           -1.11e+01   3.48e+01   -0.32  0.75104    </span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; catvarA7            4.13e-01   3.75e-02   11.01  &lt; 2e-16 ***</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; catvarB1           -4.05e-01   1.12e-01   -3.63  0.00029 ***</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; catvarB2           -4.31e-01   1.15e-01   -3.74  0.00019 ***</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; catvarB3           -2.44e+00   3.35e-01   -7.28  3.4e-13 ***</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; catvarB7           -7.16e-01   1.12e-01   -6.37  1.8e-10 ***</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; nvarA              -8.55e-02   7.67e-03  -11.15  &lt; 2e-16 ***</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="co">#&gt; nvarB               5.35e-03   3.16e-04   16.91  &lt; 2e-16 ***</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="co">#&gt; nvarC              -4.20e-02   8.76e-04  -47.97  &lt; 2e-16 ***</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 111015  on 1939052  degrees of freedom</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 107649  on 1939036  degrees of freedom</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a><span class="co">#&gt; AIC: 107683</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 15</span></span></code></pre></div>
<p>Tidy summaries of the robust models are available.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">print</span>(result<span class="sc">$</span>robust<span class="sc">$</span>summary)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt;                 names  estimate robust_se      2.5%     97.5%       z  p_value</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; 1         (Intercept) -3.21e+00  7.03e-01 -4.59e+00 -1.84e+00  -4.575 4.76e-06</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; 2  assigned_treatment -2.73e-01  3.10e-01 -8.80e-01  3.35e-01  -0.880 3.79e-01</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; 3        trial_period  1.73e-03  4.07e-03 -6.25e-03  9.70e-03   0.424 6.71e-01</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; 4   I(trial_period^2)  1.27e-06  9.52e-06 -1.74e-05  1.99e-05   0.133 8.94e-01</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; 5       followup_time  2.85e-03  3.40e-03 -3.81e-03  9.52e-03   0.840 4.01e-01</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; 6  I(followup_time^2) -6.90e-06  1.62e-05 -3.87e-05  2.49e-05  -0.426 6.70e-01</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; 7            catvarA1  2.98e-01  1.88e-01 -6.99e-02  6.66e-01   1.587 1.12e-01</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; 8            catvarA2  1.52e-01  2.84e-01 -4.03e-01  7.08e-01   0.537 5.91e-01</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; 9            catvarA3 -1.11e+01  9.45e-01 -1.29e+01 -9.20e+00 -11.697 0.00e+00</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; 10           catvarA7  4.13e-01  2.17e-01 -1.32e-02  8.39e-01   1.899 5.75e-02</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; 11           catvarB1 -4.05e-01  3.06e-01 -1.00e+00  1.94e-01  -1.325 1.85e-01</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; 12           catvarB2 -4.31e-01  3.64e-01 -1.14e+00  2.82e-01  -1.186 2.36e-01</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; 13           catvarB3 -2.44e+00  9.25e-01 -4.25e+00 -6.27e-01  -2.637 8.36e-03</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; 14           catvarB7 -7.16e-01  3.04e-01 -1.31e+00 -1.20e-01  -2.354 1.86e-02</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; 15              nvarA -8.55e-02  4.49e-02 -1.74e-01  2.55e-03  -1.903 5.70e-02</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; 16              nvarB  5.35e-03  2.22e-03  1.00e-03  9.70e-03   2.412 1.59e-02</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; 17              nvarC -4.20e-02  6.89e-03 -5.55e-02 -2.85e-02  -6.102 1.05e-09</span></span></code></pre></div>
<p>Also the sandwich robust variance-covariance matrix.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># only print the first columns</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">head</span>(result<span class="sc">$</span>robust<span class="sc">$</span>matrix, <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">4</span>))</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt;                    (Intercept) assigned_treatment trial_period</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; (Intercept)           4.94e-01           1.63e-02    -1.67e-03</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; assigned_treatment    1.63e-02           9.61e-02     3.73e-05</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; trial_period         -1.67e-03           3.73e-05     1.66e-05</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; I(trial_period^2)     2.58e-06          -2.87e-07    -3.58e-08</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; followup_time        -1.68e-04          -5.04e-05    -2.87e-06</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; I(followup_time^2)   -1.05e-06           1.82e-07     1.74e-08</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; catvarA1             -3.57e-03           4.86e-03    -6.88e-05</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; catvarA2             -1.32e-02           1.01e-02     3.44e-05</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; catvarA3             -1.47e-02           7.06e-03    -3.68e-05</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; catvarA7             -3.77e-02           1.55e-03     2.56e-04</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; catvarB1             -8.53e-02          -2.10e-02     3.82e-05</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; catvarB2             -8.70e-02          -2.41e-02     3.00e-05</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; catvarB3             -1.32e-01          -2.62e-02     2.62e-04</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; catvarB7             -1.19e-01          -2.02e-02     6.13e-06</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; nvarA                -2.51e-03          -1.07e-03     1.33e-06</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; nvarB                 1.08e-04           7.11e-05    -4.79e-07</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; nvarC                -2.66e-03           3.10e-05     2.05e-07</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt;                    I(trial_period^2)</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; (Intercept)                 2.58e-06</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; assigned_treatment         -2.87e-07</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt; trial_period               -3.58e-08</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt; I(trial_period^2)           9.07e-11</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co">#&gt; followup_time               9.13e-09</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co">#&gt; I(followup_time^2)         -4.23e-11</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="co">#&gt; catvarA1                    1.80e-07</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="co">#&gt; catvarA2                   -2.61e-08</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="co">#&gt; catvarA3                    1.58e-07</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co">#&gt; catvarA7                   -4.31e-07</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co">#&gt; catvarB1                   -6.24e-09</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="co">#&gt; catvarB2                    2.11e-08</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="co">#&gt; catvarB3                   -2.47e-07</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="co">#&gt; catvarB7                    3.97e-07</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="co">#&gt; nvarA                       1.18e-08</span></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="co">#&gt; nvarB                      -1.31e-09</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="co">#&gt; nvarC                      -8.41e-10</span></span></code></pre></div>
</div>
<div id="flexible" class="section level2">
<h2>Flexible Analysis</h2>
<p>To gain complete control over the analysis and to inspect the
intermediate objects, it can be useful to run the the data preparation
and modelling steps separately.</p>
<p>This also allows for processing of very large data sets, by doing the
data preparation in chunks and then sampling from the expanded trial
data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># for the purposes of the vignette, we use a temporary directory, however it may be useful to use a permanent</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># location in order to inspect the outputs later</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>working_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(<span class="cn">TRUE</span>), <span class="st">&quot;trial_emu&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(working_dir)) <span class="fu">dir.create</span>(working_dir)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>prep_data <span class="ot">&lt;-</span> <span class="fu">data_preparation</span>(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="at">data =</span> trial_example,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="at">period =</span> <span class="st">&quot;period&quot;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="at">eligible =</span> <span class="st">&quot;eligible&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;outcome&quot;</span>,</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="at">outcome_cov =</span> <span class="sc">~</span> catvarA <span class="sc">+</span> catvarB <span class="sc">+</span> nvarA <span class="sc">+</span> nvarB <span class="sc">+</span> nvarC,</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  <span class="at">data_dir =</span> working_dir,</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  <span class="at">save_weight_models =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  <span class="at">estimand_type =</span> <span class="st">&quot;PP&quot;</span>,</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="at">pool_cense =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  <span class="at">use_censor_weights =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  <span class="at">chunk_size =</span> <span class="dv">500</span>,</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  <span class="at">separate_files =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  <span class="at">switch_n_cov =</span> <span class="sc">~</span> nvarA <span class="sc">+</span> nvarB,</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>)</span></code></pre></div>
<p>Use <code>summary</code> to get an overview of the result.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">summary</span>(prep_data)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; Expanded Trial Emulation data</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; Expanded data saved in 396 csv files:</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;   1:   /tmp/Rtmp0gS2kL/trial_emu/trial_1.csv</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt;   2:   /tmp/Rtmp0gS2kL/trial_emu/trial_2.csv</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt;   3:   /tmp/Rtmp0gS2kL/trial_emu/trial_3.csv</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt;  ---                                        </span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; 394: /tmp/Rtmp0gS2kL/trial_emu/trial_394.csv</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; 395: /tmp/Rtmp0gS2kL/trial_emu/trial_395.csv</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; 396: /tmp/Rtmp0gS2kL/trial_emu/trial_396.csv</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; Number of observations in expanded data: 963883 </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; First trial period: 1 </span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; Last trial period: 396 </span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt; Weight models</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt; -------------</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#&gt; Treatment switch models</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt; -----------------------</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#&gt; switch_models$switch_d0:</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co">#&gt;  P(treatment = 1 | previous treatment = 0) for denominator </span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">#&gt;         term estimate std.error statistic p.value</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">#&gt;  (Intercept)    -3.84    0.0479     -80.3       0</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co">#&gt; switch_models$switch_n0:</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co">#&gt;  P(treatment = 1 | previous treatment = 0) for numerator </span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co">#&gt;         term estimate std.error statistic p.value</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co">#&gt;  (Intercept) -3.82037    0.0679   -56.244   0.000</span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a><span class="co">#&gt;        nvarA  0.00411    0.0294     0.140   0.889</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a><span class="co">#&gt;        nvarB -0.00066    0.0013    -0.509   0.611</span></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a><span class="co">#&gt; switch_models$switch_d1:</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a><span class="co">#&gt;  P(treatment = 1 | previous treatment = 1) for denominator </span></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a><span class="co">#&gt;         term estimate std.error statistic p.value</span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a><span class="co">#&gt;  (Intercept)     4.38    0.0682      64.2       0</span></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a><span class="co">#&gt; switch_models$switch_n1:</span></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a><span class="co">#&gt;  P(treatment = 1 | previous treatment = 1) for numerator </span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a><span class="co">#&gt;         term estimate std.error statistic   p.value</span></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a><span class="co">#&gt;  (Intercept)  4.02225   0.11676   34.4500 4.50e-260</span></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a><span class="co">#&gt;        nvarA -0.00226   0.04403   -0.0514  9.59e-01</span></span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a><span class="co">#&gt;        nvarB  0.00758   0.00231    3.2885  1.01e-03</span></span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------</span></span></code></pre></div>
<p>For more information about the weighting models, we can inspect them
individually</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>prep_data<span class="sc">$</span>switch_models<span class="sc">$</span>switch_n0</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; P(treatment = 1 | previous treatment = 0) for numerator </span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt;         term estimate std.error statistic p.value</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt;  (Intercept) -3.82037    0.0679   -56.244   0.000</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt;        nvarA  0.00411    0.0294     0.140   0.889</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt;        nvarB -0.00066    0.0013    -0.509   0.611</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt;  null.deviance df.null logLik  AIC  BIC deviance df.residual  nobs</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;           4330   21263  -2165 4335 4359     4329       21261 21264</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; Object saved at &quot;/tmp/Rtmp0gS2kL/trial_emu/weight_model_switch_n0.rds&quot;</span></span></code></pre></div>
<p>If <code>save_weight_models = TRUE,</code> the full model objects are
saved in <code>working_dir</code>, so you can inspect the data used in
those models and further investigate how well those models fit.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">list.files</span>(working_dir, <span class="st">&quot;*.rds&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;weight_model_switch_d0.rds&quot; &quot;weight_model_switch_d1.rds&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; [3] &quot;weight_model_switch_n0.rds&quot; &quot;weight_model_switch_n1.rds&quot;</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co"># The path is stored in the saved object</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>switch_n0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(prep_data<span class="sc">$</span>switch_models<span class="sc">$</span>switch_n0<span class="sc">$</span>path)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="fu">summary</span>(switch_n0)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; glm(formula = treatment ~ nvarA + nvarB, family = binomial(link = &quot;logit&quot;), </span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt;     data = data)</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt; (Intercept) -3.82037    0.06792  -56.24   &lt;2e-16 ***</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; nvarA        0.00411    0.02943    0.14     0.89    </span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; nvarB       -0.00066    0.00130   -0.51     0.61    </span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 4329.7  on 21263  degrees of freedom</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 4329.4  on 21261  degrees of freedom</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a><span class="co">#&gt; AIC: 4335</span></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a><span class="fu">hist</span>(switch_n0<span class="sc">$</span>fitted.values, <span class="at">main =</span> <span class="st">&quot;Histogram of weights from model switch_n0&quot;</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAADAFBMVEUAAAABAQECAgIDAwMEBAQFBQUGBgYHBwcICAgJCQkKCgoLCwsMDAwNDQ0ODg4PDw8QEBARERESEhITExMUFBQVFRUWFhYXFxcYGBgZGRkaGhobGxscHBwdHR0eHh4fHx8gICAhISEiIiIjIyMkJCQlJSUmJiYnJycoKCgpKSkqKiorKyssLCwtLS0uLi4vLy8wMDAxMTEyMjIzMzM0NDQ1NTU2NjY3Nzc4ODg5OTk6Ojo7Ozs8PDw9PT0+Pj4/Pz9AQEBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBRUVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7////isF19AAAACXBIWXMAAA7DAAAOwwHHb6hkAAATHElEQVR4nO2deWAURbrAv5yEkBOyISSBGIjCk4ggVxAeICiXYTkUHiq6XIuAokFBQA5FWJ8CAskKhre4IIfcrFyBxxkEVNAnh7xFWGEVXIjcdxIS5tuqnumZmqP7m9CTg6Z+f3S6uqq++uaX6WOmjwGU6ALlnUBFRwoikIIIpCACKYhACiKQggikIAIpiEAKIpCCCKQgAimIQAoikIIIpCACKYhACiKQggikIAIpiEAKIpCCCKQgAimIQAoikIIIpCACKYhACiKQggh8Kuiz5MDaVJtOEKK9YG9GxtG7jFsi9gB8oJ+VHV8KOhsEEEc10hWUDbD5LuOWiHIStBPglatUo43Zf3FeQAvyKm6JKImgyS0jH+i6U5m/mVEz5f2VAHsQm0BiwUsReWhZ2jK28oNDT7HaFGi4PiW0cTZ+3iKs3hx7gNuOAJsBsq0LW0DlIiwIggTEQwCvIx7vkxLW6OMieyrCUGzB1f61fvf8acThyQD1BjKJ7eLCUkefV4ewxlVTEgb0nJL7UqELnnkhvvbwHVZBrlkp2Ae3vghQ8JvCaoqb89mGqqBXAPLwQ2t9yjU+bqg/n+/mx6ef28JdedQe4EllTlk6AeB73M9KZ/FTgPW4PUypSy+ypSIO1QmCmvFSkyJrhDScbx30wSvWIWxxbSkJA2qk5LZU7HIiUQmtCHLNSsExuPoieu5YXB0C/x8xk7Vd3RtsggKhSfqlolCoveXLXvw1snGh3aIXgE+fB+hqi5fhCDCMDVuribJ0F8AnOIe13YBDIPBaUT2ot++f7OV9bEtFHKoTQM052TEA+9VVrBbEbd43HGCadQhbXFtKwoAaKbktFbv0Aei35kXggtyyUnAMbnsR9e8g5gIMRkyChNtoaW4TBHxTcWbQoHWK1Exl3F/wdhTAz1gQAY9Yw7HVyBHAsYoVVoF+OACSYBKL1Ao3Aaxmb5sa0NCWijgUE7QPuc0lNkH5AA2OY+HbY1a4rGI8JacBPabktlTsctofOrEmT3BBbllxhMFtL+I9vjgOWuMNPxjCZrNsgipZlA4Xl43uUhlgFh/3QWX0FDZ9AFKt8X4ARwBBEHaG/8AG8CfoWhgM7+JMNmpaWlo4+N9RUnEaiq1ibKh1APPUdxB7x0D9UTuKXbdBPCWnAT2m5LZU7MJCLWSzf+GCXLOyIgxufRHz+NLGUAsPA/t/I/7NJihBaZ4VDOD/oE1QKqpTezYbwRFAFPQR+J0NjDoJ8d/ycCNB5bKSitNQ1tw2CIIOtlTa1j7gIijBdUCPKbktFbuwN+o2NruFC3LNyoowuPIiYDJfGg8t8AzAcDY7V91I8+WH/aHpphv7tAWxl2oPIApi+6734CmMgQkQXoSzAI6rbweeitNQ7oIQT85sEwDQ3EVQouuA3gkSuywFWMxml3FBrlmp2AdXXgQ0sCjb1AGIYVDnjrLPcAj6BGCNkraWoPxAIYAgyBILCTAOO0I830rmKGFw3vR5tlTEoVwEbcJD06ezw4rTtSHKgyCnAb0TJHZhO6V0trgnF+SWlfKfFQZXXgRA793L4iDgIDsKYfPr+4MoaCFAx91LYwFmamXzqhBAEITPsThr8W1Qtu9FKZCUe4IVxtlSEYcSBbFtw6TrewGe/u7osqrQxoMgpwG9EyR2KU5im+oNQ6x7MdesOE6DP2dfCf34VuyMcoiQKArKi+aL6gIM1crmUqojgCiIHf7AGVzDpn9npZzKSqsnbtpSEYcSBe3mx0F30q1JBe3xJEgc0EtBYpfZymySchzkmhXHaXD+ImBSi4ikp3colWefi096Y4koCPe1DHtkcl4g+F/XyAYLHQFEQb+woxvEUwDxSvGHHknhj2UVoJqKMJQoCMdXD+2N+R+nxQUn9fxOjeUkSBzQS0FiF9yWHvvAy9usR9KuWXHEwfmLED6LHTx4jE2nAZzG0qYMhzKKIKge+C+7llud7fxLnTIcyiiCoL1VlbUv7kjpj1qGQxlF/Lrj6kf901/+5FZZDFuGQxlEfuVKIAURSEEEUhCBFEQgBRFIQQRSEIEURCAFEUhBBFIQgRREIAURSEEEUhCBFEQgBRFIQQRSEIEURCAFEUhBBFIQgRREIAURSEEEUhCBFEQgBRFIQQRSEME9Lehsn14C00pljHta0N4HPnIwolGpjHFvC2r4g4MVFVjQN0+qJH/ri3jecs8IurV9q42H9/oinrfcM4IcpH3t23j6SEEEUhCBFEQgBRFIQQRSEIEURCAFEUhBBGUq6MNTvghnYkGRfq3nXjQczsSCCr7oUyWo67KbxsKZWBDj5vIelcJe3FRkIJy5BeGxDx+BcL+4BSUNYrmk0tTEgr4d9zDEDdla9M8/+ueVMMjOaJXAtb5NT58yFZQItTJ23+Fz1yH3rsOZeBUba/+ytPinu98KmVgQnsrMx2Mf/WosnIkFHQkLvoYHqkXtNxTOxII6tDrDpvld2xoKZ2JB0dbHEP5vhKFwJhb0kPVJltkphsKZWNCEqJVFeGdd1VGGwplYUPFA/8C4YOhVaCiciQUhHl84Zd4hg+FMLcgXmFjQxVdapikYCmdiQc8Gdh2pYCiciQVFTPVFOPMKug27fBHOvIKwfV/vOhSev+S27PwKlYe+9FlmXlCmgmZHNxo7bTpDr/Wpt5P9ACqljDnptPhwb/VCyphNpZKlBmX7hZmKTuPvQ2sOzVy0MOvV2tEHPbcw8SrmDW072558WPTck55bmFvQqR+IxhGr1LndUZ5bmFnQ5jgAbJ+l17jJMHXu3eaeW5hY0KLAwYsAJ/jN1Wm8yq/zp18d/fGbhT0DVnluYWJBD4/AC6wwKlWv9YYnrI+ubpej0cDEgkJzFEE5VfTbXzqydeth7XP4Jhb02DuKoPcaEB08HSg6MLGg+UGTv4JznwbP0GutcaDowMSCMKsa27pUGmPRaXyfHyje2Ld8x3ntligPFEnu6wPFdBWdxvf1gWI/TvdY/1d1Gt/XB4pWbnRoqtf6fj5QtJEL53TbezxQPGS/sTZGy1ypUB6CFlTW28+j5wPFi/fDN4qLFd6toXt1x/18oBiiEJrm6ZdyVe7zA0WaCnCgmDdaoG9FE1QBDhS31RrhoH1ZCopxkKi1na4AB4rbmgtOJpaloAX+yaNmjq4TmZmdna31o0QV4ECx/AT1eYpf/FvUcahe6/I/UCw/QdVXK3++SNBvX97fKJafoFozlT9ZNeg+l4/f0aoysaDhEevYdEPkH/RaL2pxGPPSAcJnaTQwsaD8dKiaWhWaXdZpnAn/mYcdEj7ZNCpwoecWJhaE+M2MjPf1rz1IHsuO1IB/3BqjkY2pBdGnnqut5j/XfYPN5YR7bmFmQV6ceu7epRCLwvnPbY+9/w4UvTn1fDQ2derOKfF/3Tk2aKnnFiYW5NWp5+NDrT+QWn+502LhjsMvSiVLB+UnyMtTz7dPfr3xK7dvgy6r96w2M+87yNtTz/qYeBXz6tQziYkFeXPqmca8gm7/nE+feqYxr6CC6NW+CGdeQfhmN2MrlxUTC1re5NHRM2YxDIUzsaA4FUPhzCpo228+CmdWQcC/g5+id87QS0wtCDTOVJQEKYhACiKQggikII/c3KY+kbx+aT+RvLwEhcfExCiTmJi7CLLP/kz7yPW+TU/h5xMOFpWPoAwBQ+FKYxXbEpLoILI8z2r4gNIQtK6toOENKcgNKYhACiKQggikIAIpiEAKIpCC3MmtGu0gTApyY3m7vQ763VuCyuSu5+UdhVf+8j0kqKxuZrkbQUtqzRXY7JM8sISCSvNmlhPiTRjd7kLQtKhnHXSse7d5uFKeN7MUC19jnJj6sHATRqO7EDS1nlBYXz6CtG5m+Yf9X5+wlZe3DxZIbyP81GerlMYOkkDkwQEO6icLhYa1hELTeKHQMlYotK0qFJ4OEEOHPykwoBQFad3McvoDlYHK4/APfSDwxgihMPI1oTD6VaEwdqhQGP+yUJgwWCi8M1AoTOovFCaLhSl/EArvvyTmo3EBs08E0TezmI+S7cXIm1nMR0mPg4ibWaxsnDJXg/ff0aqZOk6rZuZbWjVZb2rVzMnQqskeX7qCvOLFZoM1SGugVdP2Ia2aTklaNd2qa9X0jtKqeYm4SrVMBL39J62a6W9q1czvp1WzrqtWzd7HtWp+1NzNny/haRspiEAKIpCCCKQgAimIQAoikIIISkXQRM3Hv2eO1qpZPEirZlMPrZp9rbVqfqqvVXO5hJfxloqgm1qPbsD8G1o1t69q1RRr3mds0f7Mc+EuajxSKoLMhBREIAURSEEEUhCBFEQgBRFIQQRSEIEURCAFEUhBBL4QtKpp5BMHPBS28t9W32Y7P+71U088R/tz87C604pcq41Gu56RXKXxSt0APhC0wW/oyk5VTrkV7jTjPwf4azZncMgJQ9EmwxsbxgROcKk2HK1v+Myc/rBVL4IPBD3RCfFWzbddCqdntwb77yUWP/bfhqIVRrzGSm9WLnauNhrtit9CREtdza/qOMYFXYJP2XRIskshp1WrELugzAbe/oS952gnYAubWQUnnaoNRzve9ic207q3Xgjjgo7AV2ya6VfoVkhRBV2I8PqKOM/RCn4qYDMjKuc7VRuOxpdaciov0gthXNA24LeTL4LzbgW7oDEaTzwrUTRcHDjKZYnRaIzMENC/Q864oK3wI5suhEtuBVXQ+SrrjEc79yL0K3KuNhyNcfJvo4J0f9bRuKDD8A2bZlVyL6iCZsR6uwXSjrYxNvkL12rD0ayMqKMXwrigi3xXgMPruBdUQY8ONxxtY8CwfLdqw9FWduFPvJkHN3VC+GA3364nYlHt0e4Fm6BjsN1otKL4Fz1VG42WA/vZdKDeD4P6QlBOwKQ9z0efRJzbp8BRQLugOQHXjUbbDm8t4OQ7xTcc7fbjtRdsHumfrRfBFx81VjaLbM+P4Afxp5iqBbQLerah4WjZts8reU7xjUe7NqhuWJMlugHkh1UCKYhACiKQggikIAIpiEAKIpCCCKQgAimIQAoikIIIpCACKYhACiKQggikIAIpiEAKIpCCCKQgAimIQAoikIIIpCCCCi1oY3kngGUlKGwe4oFvHeVEnR/IsV+KemVNyOor7O/hp8IKFofYAohRrGRr3aUb87GBjO2UjaA+WxH7dneUdQTZL0XdHpMQlFp9P+JLqd9YcnvZAohRrJhCEIcUZL3Kyn5das0Bt6Ms3Zohdu8rBDCBoEMdo6r1OIUteiB+CQMQ18JBjJqHaQBwpXhi3egOR5igGeNrRz4r3rOcOPtJiOx10XEp6r9gN0bhru6WhqwjX8WUAMoEFzQOrf9X1uzGy4mJQ2dZBfXgz5m0JAzDa6+nhNSebLEKClnMlvZLZxO1jy09r/G5oFvVH186N/4pnFjNgh/AQ4ijYi1c0MVnOuVZBkbOXtIq7BQmVu+7a1bIa0K3xOgXcqcGvuK4FLUweDwqj9q70OmZPGSClADKJCtoYk6G3xz2bouYsbJNmFXQEmCv+mvWu2f09HWvw+cugtQ+anpe43NB38E2xC9G4m44gr9vD79hC7aGMEF85TjuvwLxX8GZmMgvGXqpjdAtsSH7n3dtKVyKOhY6hB7hVXwV4xtpdRW7UW0ym/ljLO6AdYgFCVZBVyvNRhyZjPgMvx6q7lvOgux91PS8xueCLoQ/Mv8M+1sUPht/t7by6lvBC+2CFgby7cy1fEzk175ntBK6JY5lk5FpwqWolkWtARoccBe0D766cOHCIjj1QTTvmWHbBqV3REyewOeuH5gXNNJZkL2Pmp7X+H4b9H9dQ6DRGvZ2+K/jfpfbjciFs3ZBU9THQiTORFdB01AR5HRdasTWtOiLboKW2y4QO5yh/KrwDJug+cHXvud29zTwi+8c7yLI3seenreUxl7s1paOAT9iVtz8VHyn6ZRH0S5oXvAdVjhwzLoXcxbEL1ZmguyXov6ynnXDywHr3QTtgHPWPtOq8uk4m6BLQSvHNeF/hv2GmCYK6p7u6GNPz1t8LmjFQzcQT8ImPAptBuP2wJb8gnaboIN8o5Ff7SMdQfZLUXMCCpigwqBcN0HnKvEd3YT2uAs2IBbXU3fzHfrWY2/MLfATG6OGTVDou4g3Y9MdfezpeYvPBR0PfnrD0g4xbBeeCJ/hzSDlZiMuqH/974p7VZu75feRv+oJUi9FPR/O92Ljo2/aBfEAymR08JScUX6ZbC8W+ee1nWvGWK9hxf8JCWBr889BvXavbV6lywVFUFqNz3I7+rO9mNrHkZ6X+H4VW9+4SkwX/jTl/vAPxBbKLSNc0M7k8KuFI+uEt9mPeoLs16WujqwZWCdit2MjzQMoE8v01NCH+b7q+uCaNQZviLFdw3ouoAOPtKxulWbrP4ueqAj6e+vK0ORVJsjex56el1TgD6tXt4TmXDMcxWLw9y0rsCDEKLpJqVOugjY2VPnOY31BGefjiQr9DqoISEEEUhCBFEQgBRFIQQRSEIEURCAFEUhBBFIQgRREIAURSEEEUhCBFEQgBRFIQQRSEIEURCAFEUhBBP8G5NHeD+rLWuUAAAAASUVORK5CYII=" /><!-- --></p>
<p>We also see the expanded trial files:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">head</span>(prep_data<span class="sc">$</span>data)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;/tmp/Rtmp0gS2kL/trial_emu/trial_1.csv&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; [2] &quot;/tmp/Rtmp0gS2kL/trial_emu/trial_2.csv&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; [3] &quot;/tmp/Rtmp0gS2kL/trial_emu/trial_3.csv&quot;</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt; [4] &quot;/tmp/Rtmp0gS2kL/trial_emu/trial_4.csv&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; [5] &quot;/tmp/Rtmp0gS2kL/trial_emu/trial_5.csv&quot;</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; [6] &quot;/tmp/Rtmp0gS2kL/trial_emu/trial_6.csv&quot;</span></span></code></pre></div>
<p>Each of these csv files contains the data for the trial starting at
period <code>_i</code>. To create a manageable dataset for the final
analysis we can sample from these trials.</p>
<p>Here we sample 10% of the patients without an event at each follow-up
time in each trial. All observations with events are included.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>sampled_data <span class="ot">&lt;-</span> <span class="fu">case_control_sampling_trials</span>(prep_data, <span class="at">p_control =</span> <span class="fl">0.1</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">str</span>(sampled_data)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   100009 obs. of  13 variables:</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt;  $ id                : int  484 31 484 140 54 54 176 31 54 423 ...</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt;  $ trial_period      : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt;  $ followup_time     : int  1 2 5 5 5 6 6 7 7 8 ...</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt;  $ outcome           : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt;  $ weight            : num  1 0.999 0.998 0.998 0.998 ...</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt;  $ treatment         : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt;  $ catvarA           : Factor w/ 5 levels &quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 5 5 5 5 5 5 5 5 5 5 ...</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt;  $ catvarB           : Factor w/ 5 levels &quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 5 5 5 5 5 5 5 5 5 5 ...</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt;  $ nvarA             : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt;  $ nvarB             : int  1 0 1 0 0 0 0 0 0 0 ...</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt;  $ nvarC             : int  55 40 55 46 49 49 45 40 49 56 ...</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt;  $ assigned_treatment: int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt;  $ sample_weight     : num  10 10 10 10 10 10 10 10 10 10 ...</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span></code></pre></div>
<p>Before proceeding with the modelling, it is possible to manipulate
and derive new variables and adjust factor levels in the
<code>data.frame</code>. You can also specify transformations in a
formula to <code>outcome_cov</code>, <code>include_followup_time</code>
or <code>include_trial_period</code>, such as
<code>~ ns(trial_period)</code> or
<code>~ I(nvarA^2) + nvarC &gt; 50 + catvarA:nvarC</code>.</p>
<p>It is also possible to specify formulas in <code>trial_msm()</code>
to include, for example, splines with <code>ns()</code>.</p>
<p>Now we can fit the model with the <code>trial_msm()</code> function.
Since we have sampled from the data, we should make use of the
<code>use_sample_weights</code> option to get correct survival
estimates.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>model_result <span class="ot">&lt;-</span> <span class="fu">trial_msm</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="at">data =</span> sampled_data,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="at">outcome_cov =</span> <span class="fu">c</span>(<span class="st">&quot;catvarA&quot;</span>, <span class="st">&quot;catvarB&quot;</span>, <span class="st">&quot;nvarA&quot;</span>, <span class="st">&quot;nvarB&quot;</span>, <span class="st">&quot;nvarC&quot;</span>),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="at">model_var =</span> <span class="st">&quot;assigned_treatment&quot;</span>,</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="at">glm_function =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="at">use_sample_weights =</span> <span class="cn">TRUE</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; Preparing for model fitting</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; Fitting outcome model</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; Warning in eval(family$initialize): non-integer #successes in a binomial glm!</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; glm(formula = outcome ~ assigned_treatment + trial_period + I(trial_period^2) + </span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt;     followup_time + I(followup_time^2) + catvarA + catvarB + </span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt;     nvarA + nvarB + nvarC, family = binomial(link = &quot;logit&quot;), </span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt;     data = data, weights = w)</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="co">#&gt;                     Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a><span class="co">#&gt; (Intercept)        -2.34e+00   2.26e-01  -10.36  &lt; 2e-16 ***</span></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a><span class="co">#&gt; assigned_treatment -4.22e-01   5.34e-02   -7.90  2.8e-15 ***</span></span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a><span class="co">#&gt; trial_period       -1.70e-03   8.48e-04   -2.00  0.04539 *  </span></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a><span class="co">#&gt; I(trial_period^2)   9.70e-06   1.92e-06    5.07  4.0e-07 ***</span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a><span class="co">#&gt; followup_time       5.27e-03   1.18e-03    4.47  8.0e-06 ***</span></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a><span class="co">#&gt; I(followup_time^2) -3.29e-05   8.55e-06   -3.85  0.00012 ***</span></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a><span class="co">#&gt; catvarA1            3.55e-01   4.03e-02    8.80  &lt; 2e-16 ***</span></span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a><span class="co">#&gt; catvarA2            4.67e-01   5.38e-02    8.69  &lt; 2e-16 ***</span></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a><span class="co">#&gt; catvarA3           -1.03e+01   5.21e+01   -0.20  0.84369    </span></span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a><span class="co">#&gt; catvarA7            3.37e-01   6.41e-02    5.26  1.4e-07 ***</span></span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a><span class="co">#&gt; catvarB1           -4.77e-01   1.85e-01   -2.58  0.01002 *  </span></span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a><span class="co">#&gt; catvarB2           -2.35e-01   1.89e-01   -1.24  0.21340    </span></span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a><span class="co">#&gt; catvarB3           -2.48e+00   3.66e-01   -6.78  1.2e-11 ***</span></span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a><span class="co">#&gt; catvarB7           -9.45e-01   1.88e-01   -5.03  5.0e-07 ***</span></span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a><span class="co">#&gt; nvarA              -2.46e-02   8.78e-03   -2.80  0.00516 ** </span></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a><span class="co">#&gt; nvarB               3.02e-03   3.86e-04    7.83  4.8e-15 ***</span></span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a><span class="co">#&gt; nvarC              -5.09e-02   1.23e-03  -41.40  &lt; 2e-16 ***</span></span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 53314  on 100008  degrees of freedom</span></span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 50790  on  99992  degrees of freedom</span></span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a><span class="co">#&gt; AIC: 50733</span></span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 13</span></span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------</span></span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a><span class="co">#&gt; Calculating robust variance</span></span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a><span class="co">#&gt; Summary with robust standard error:</span></span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a><span class="co">#&gt;                 names  estimate robust_se      2.5%     97.5%       z  p_value</span></span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a><span class="co">#&gt; 1         (Intercept) -2.34e+00  1.05e+00 -4.40e+00 -2.88e-01  -2.234 2.55e-02</span></span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a><span class="co">#&gt; 2  assigned_treatment -4.22e-01  4.21e-01 -1.25e+00  4.04e-01  -1.002 3.16e-01</span></span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a><span class="co">#&gt; 3        trial_period -1.70e-03  5.06e-03 -1.16e-02  8.22e-03  -0.336 7.37e-01</span></span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a><span class="co">#&gt; 4   I(trial_period^2)  9.70e-06  1.12e-05 -1.23e-05  3.17e-05   0.866 3.87e-01</span></span>
<span id="cb14-56"><a href="#cb14-56" tabindex="-1"></a><span class="co">#&gt; 5       followup_time  5.27e-03  5.68e-03 -5.86e-03  1.64e-02   0.928 3.53e-01</span></span>
<span id="cb14-57"><a href="#cb14-57" tabindex="-1"></a><span class="co">#&gt; 6  I(followup_time^2) -3.29e-05  5.15e-05 -1.34e-04  6.81e-05  -0.639 5.23e-01</span></span>
<span id="cb14-58"><a href="#cb14-58" tabindex="-1"></a><span class="co">#&gt; 7            catvarA1  3.55e-01  2.65e-01 -1.64e-01  8.73e-01   1.340 1.80e-01</span></span>
<span id="cb14-59"><a href="#cb14-59" tabindex="-1"></a><span class="co">#&gt; 8            catvarA2  4.67e-01  3.66e-01 -2.50e-01  1.18e+00   1.278 2.01e-01</span></span>
<span id="cb14-60"><a href="#cb14-60" tabindex="-1"></a><span class="co">#&gt; 9            catvarA3 -1.03e+01  8.27e-01 -1.19e+01 -8.66e+00 -12.433 0.00e+00</span></span>
<span id="cb14-61"><a href="#cb14-61" tabindex="-1"></a><span class="co">#&gt; 10           catvarA7  3.37e-01  3.54e-01 -3.56e-01  1.03e+00   0.954 3.40e-01</span></span>
<span id="cb14-62"><a href="#cb14-62" tabindex="-1"></a><span class="co">#&gt; 11           catvarB1 -4.77e-01  6.61e-01 -1.77e+00  8.19e-01  -0.721 4.71e-01</span></span>
<span id="cb14-63"><a href="#cb14-63" tabindex="-1"></a><span class="co">#&gt; 12           catvarB2 -2.35e-01  6.97e-01 -1.60e+00  1.13e+00  -0.337 7.36e-01</span></span>
<span id="cb14-64"><a href="#cb14-64" tabindex="-1"></a><span class="co">#&gt; 13           catvarB3 -2.48e+00  1.11e+00 -4.66e+00 -3.00e-01  -2.230 2.58e-02</span></span>
<span id="cb14-65"><a href="#cb14-65" tabindex="-1"></a><span class="co">#&gt; 14           catvarB7 -9.45e-01  6.76e-01 -2.27e+00  3.79e-01  -1.399 1.62e-01</span></span>
<span id="cb14-66"><a href="#cb14-66" tabindex="-1"></a><span class="co">#&gt; 15              nvarA -2.46e-02  5.48e-02 -1.32e-01  8.29e-02  -0.448 6.54e-01</span></span>
<span id="cb14-67"><a href="#cb14-67" tabindex="-1"></a><span class="co">#&gt; 16              nvarB  3.02e-03  2.42e-03 -1.71e-03  7.76e-03   1.251 2.11e-01</span></span>
<span id="cb14-68"><a href="#cb14-68" tabindex="-1"></a><span class="co">#&gt; 17              nvarC -5.09e-02  9.26e-03 -6.90e-02 -3.27e-02  -5.495 3.91e-08</span></span>
<span id="cb14-69"><a href="#cb14-69" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------</span></span></code></pre></div>
<p>The result is the same type as the previous result from the simple
<code>initiators</code> function, containing the <code>glm</code> object
and the sandwich results.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">summary</span>(model_result)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; Trial Emulation Outcome Model</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; Outcome model formula:</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; outcome ~ assigned_treatment + trial_period + I(trial_period^2) + </span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt;     followup_time + I(followup_time^2) + catvarA + catvarB + </span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt;     nvarA + nvarB + nvarC</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; Coefficent summary (robust):</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt;               names  estimate robust_se      2.5%     97.5%       z p_value</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt;         (Intercept) -2.34e+00  1.05e+00 -4.40e+00 -2.88e-01  -2.234    0.03</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt;  assigned_treatment -4.22e-01  4.21e-01 -1.25e+00  4.04e-01  -1.002    0.32</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt;        trial_period -1.70e-03  5.06e-03 -1.16e-02  8.22e-03  -0.336    0.74</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt;   I(trial_period^2)  9.70e-06  1.12e-05 -1.23e-05  3.17e-05   0.866    0.39</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt;       followup_time  5.27e-03  5.68e-03 -5.86e-03  1.64e-02   0.928    0.35</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt;  I(followup_time^2) -3.29e-05  5.15e-05 -1.34e-04  6.81e-05  -0.639    0.52</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt;            catvarA1  3.55e-01  2.65e-01 -1.64e-01  8.73e-01   1.340    0.18</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co">#&gt;            catvarA2  4.67e-01  3.66e-01 -2.50e-01  1.18e+00   1.278    0.20</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt;            catvarA3 -1.03e+01  8.27e-01 -1.19e+01 -8.66e+00 -12.433  &lt;2e-16</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="co">#&gt;            catvarA7  3.37e-01  3.54e-01 -3.56e-01  1.03e+00   0.954    0.34</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="co">#&gt;            catvarB1 -4.77e-01  6.61e-01 -1.77e+00  8.19e-01  -0.721    0.47</span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="co">#&gt;            catvarB2 -2.35e-01  6.97e-01 -1.60e+00  1.13e+00  -0.337    0.74</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a><span class="co">#&gt;            catvarB3 -2.48e+00  1.11e+00 -4.66e+00 -3.00e-01  -2.230    0.03</span></span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a><span class="co">#&gt;            catvarB7 -9.45e-01  6.76e-01 -2.27e+00  3.79e-01  -1.399    0.16</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a><span class="co">#&gt;               nvarA -2.46e-02  5.48e-02 -1.32e-01  8.29e-02  -0.448    0.65</span></span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a><span class="co">#&gt;               nvarB  3.02e-03  2.42e-03 -1.71e-03  7.76e-03   1.251    0.21</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a><span class="co">#&gt;               nvarC -5.09e-02  9.26e-03 -6.90e-02 -3.27e-02  -5.495   4e-08</span></span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a><span class="co">#&gt; model_result$model contains the fitted glm model object.</span></span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a><span class="co">#&gt; model_result$robust$matrix contains the full robust covariance matrix.</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">summary</span>(model_result<span class="sc">$</span>model)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; glm(formula = outcome ~ assigned_treatment + trial_period + I(trial_period^2) + </span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt;     followup_time + I(followup_time^2) + catvarA + catvarB + </span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt;     nvarA + nvarB + nvarC, family = binomial(link = &quot;logit&quot;), </span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt;     data = data, weights = w)</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt;                     Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; (Intercept)        -2.34e+00   2.26e-01  -10.36  &lt; 2e-16 ***</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; assigned_treatment -4.22e-01   5.34e-02   -7.90  2.8e-15 ***</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt; trial_period       -1.70e-03   8.48e-04   -2.00  0.04539 *  </span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; I(trial_period^2)   9.70e-06   1.92e-06    5.07  4.0e-07 ***</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt; followup_time       5.27e-03   1.18e-03    4.47  8.0e-06 ***</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt; I(followup_time^2) -3.29e-05   8.55e-06   -3.85  0.00012 ***</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="co">#&gt; catvarA1            3.55e-01   4.03e-02    8.80  &lt; 2e-16 ***</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">#&gt; catvarA2            4.67e-01   5.38e-02    8.69  &lt; 2e-16 ***</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt; catvarA3           -1.03e+01   5.21e+01   -0.20  0.84369    </span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="co">#&gt; catvarA7            3.37e-01   6.41e-02    5.26  1.4e-07 ***</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="co">#&gt; catvarB1           -4.77e-01   1.85e-01   -2.58  0.01002 *  </span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="co">#&gt; catvarB2           -2.35e-01   1.89e-01   -1.24  0.21340    </span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="co">#&gt; catvarB3           -2.48e+00   3.66e-01   -6.78  1.2e-11 ***</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="co">#&gt; catvarB7           -9.45e-01   1.88e-01   -5.03  5.0e-07 ***</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a><span class="co">#&gt; nvarA              -2.46e-02   8.78e-03   -2.80  0.00516 ** </span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a><span class="co">#&gt; nvarB               3.02e-03   3.86e-04    7.83  4.8e-15 ***</span></span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a><span class="co">#&gt; nvarC              -5.09e-02   1.23e-03  -41.40  &lt; 2e-16 ***</span></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 53314  on 100008  degrees of freedom</span></span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 50790  on  99992  degrees of freedom</span></span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a><span class="co">#&gt; AIC: 50733</span></span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 13</span></span></code></pre></div>
<p>We can also use this object to predict cumulative incidence curves
and use these for treatment comparisons. Here we use the patients who
were in the first trial as the target population. To get the data in the
right format, we can use the <code>data_template</code> returned by
<code>data_preparation()</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">file.path</span>(working_dir, <span class="st">&quot;trial_1.csv&quot;</span>))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data.table<span class="sc">::</span><span class="fu">as.data.table</span>(prep_data<span class="sc">$</span>data_template), new_data)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>model_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_result, <span class="at">predict_times =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">40</span>), <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">&quot;cum_inc&quot;</span>)</span></code></pre></div>
<p>The <code>predict</code> function returns a list of 3 data frames:
predictions for assigned treatment 0, for assigned treatment 1 and for
the difference. It possible to change the type of predicted values,
either cumulative incidence or survival.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  model_preds<span class="sc">$</span>difference<span class="sc">$</span>followup_time,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  model_preds<span class="sc">$</span>difference<span class="sc">$</span>cum_inc_diff,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="at">ty =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Incidence Difference&quot;</span>,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Follow-up Time&quot;</span>,</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.15</span>, <span class="fl">0.05</span>)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="fu">lines</span>(model_preds<span class="sc">$</span>difference<span class="sc">$</span>followup_time, model_preds<span class="sc">$</span>difference<span class="sc">$</span><span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="fu">lines</span>(model_preds<span class="sc">$</span>difference<span class="sc">$</span>followup_time, model_preds<span class="sc">$</span>difference<span class="sc">$</span><span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
